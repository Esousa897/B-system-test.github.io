{% comment %} BOLDYASE • Cart Drawer (right) {% endcomment %}
<style>
.by-cd{position:fixed;inset:0;z-index:85;display:none}
.by-cd[aria-hidden="false"]{display:block}
.by-cd__bg{position:absolute;inset:0;background:rgba(0,0,0,.25)}
.by-cd__panel{position:absolute;right:0;top:0;bottom:0;width:400px;max-width:100vw;background:#fff;border-left:1px solid #eee;transform:translateX(100%);transition:transform .3s ease;display:grid;grid-template-rows:auto 1fr auto}
.by-cd[aria-hidden="false"] .by-cd__panel{transform:translateX(0)}
.by-cd__head{display:flex;justify-content:space-between;align-items:center;padding:16px 16px;border-bottom:1px solid #eee}
.by-cd__title{font:700 14px/1 Inter,system-ui;letter-spacing:.06em}
.by-cd__list{overflow:auto;padding:12px 16px;display:grid;gap:12px}
.by-cd__item{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;border:1px solid #f1f1f1;border-radius:10px;padding:8px}
.by-cd__thumb img{width:64px;height:80px;object-fit:cover;border-radius:6px}
.by-cd__meta{font:500 13px/1.4 Inter,system-ui}
.by-cd__meta .by-cd__name{font-weight:600;margin:0 0 4px}
.by-cd__qty{display:flex;align-items:center;gap:6px}
.by-cd__qty button{width:28px;height:28px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer}
.by-cd__foot{border-top:1px solid #eee;padding:14px 16px;display:grid;gap:10px}
.by-cd__row{display:flex;justify-content:space-between;font:600 14px/1 Inter}
.by-cd__checkout{background:#111;color:#fff;border:0;border-radius:10px;height:48px;font:700 14px/1 Inter;cursor:pointer;display:grid;place-items:center;text-decoration:none}
.by-cd__empty{padding:28px;text-align:center;color:#666}
</style>

<div id="by-cart-drawer" class="by-cd" aria-hidden="true" aria-label="Winkelwagen">
  <div class="by-cd__bg" data-close></div>
  <aside class="by-cd__panel" role="dialog" aria-modal="true">
    <div class="by-cd__head">
      <div class="by-cd__title">WINKELWAGEN</div>
      <button class="by-cd__close" data-close aria-label="Sluiten">✕</button>
    </div>
    <div class="by-cd__list" data-list></div>
    <div class="by-cd__foot">
      <div class="by-cd__row"><span>Subtotaal</span><span data-subtotal>—</span></div>
      <a href="{{ routes.cart_url }}" class="by-cd__checkout">NAAR WINKELWAGEN</a>
    </div>
  </aside>
</div>

<script>
(()=>{const e=document.querySelector('#by-cart-drawer');if(!e)return;const t=e.querySelector('[data-close]'),a=e.querySelector('.by-cd__close'),n=e.querySelector('[data-list]'),o=e.querySelector('[data-subtotal]');const r=c=>{try{return new Intl.NumberFormat('{{ localization.country.currency.iso_code | default: "EUR" }}',{style:'currency',currency:'{{ shop.currency }}'}).format(c/100)}catch{return(c/100).toFixed(2)}},s=async()=>{const c=await fetch('/cart.js',{headers:{Accept:'application/json'}});if(!c.ok)throw new Error('cart');return c.json()},d=c=>{n.innerHTML='';if(!c.items.length){n.innerHTML=`<div class="by-cd__empty">Je winkelwagen is leeg.</div>`}else{c.items.forEach((l,i)=>{const m=document.createElement('div');m.className='by-cd__item';m.innerHTML=`
<div class="by-cd__thumb">${l.image?`<img src="${l.image}" alt="${l.product_title}">`:''}</div>
<div class="by-cd__meta">
  <div class="by-cd__name">${l.product_title}</div>
  ${l.variant_title?`<div>${l.variant_title}</div>`:''}
  <div class="by-cd__qty">
    <button data-minus data-line="${i+1}" aria-label="Minder">−</button>
    <span>${l.quantity}</span>
    <button data-plus data-line="${i+1}" aria-label="Meer">+</button>
  </div>
</div>
<div class="by-cd__price">${r(l.final_line_price)}</div>`;n.appendChild(m)})}o.textContent=r(c.items_subtotal_price);document.querySelectorAll('[data-by-cart-count]').forEach(p=>{p.textContent=c.item_count})};async function u(){e.setAttribute('aria-hidden','false');document.documentElement.style.overflow='hidden';const c=await s();d(c)}function y(){e.setAttribute('aria-hidden','true');document.documentElement.style.overflow=''}document.addEventListener('click',c=>{const l=c.target.closest('[data-by-cart]');if(l){c.preventDefault();u()}if(c.target.closest('[data-close]'))y();if(c.target.closest('.by-cd__close'))y();const m=c.target.closest('[data-plus]'),p=c.target.closest('[data-minus]');if(m||p){const g=Number((m||p).dataset.line),h=Number((m?p:p).parentElement.querySelector('span').textContent),b=m?h+1:Math.max(0,h-1);fetch('/cart/change.js',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({line:g,quantity:b})}).then(f=>f.json()).then(d).catch(()=>{})}},!0);document.addEventListener('keydown',c=>{if(c.key==='Escape')y()});document.addEventListener('by:cart:open',u)})();
</script>
